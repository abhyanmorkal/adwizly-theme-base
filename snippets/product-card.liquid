{%- comment -%}
    Renders a product card

    Accepts:
    - customize: : {Object} default false. Manual customization
	- product_card_product: {Object} Product Liquid object (optional)
    - product_collection: {Object}
    - image_ratio_value: {String} Size of the product image card. Values are "auto", "portrait", "landscape", "square" and "round". Default is "auto" (optional)
    - show_button_quickview: {Boolean} Show the product button "Quick view". Default: false
    - show_badge_sold_out: {Boolean} Show the product badge "Sold Out". Default: true
    - show_badge_on_sale: {Boolean} Show the product badge "On Sale". Default: true
	- show_badge_feature: {Boolean} Show the product badge "Feature". Default: true
    - show_countdown: {Boolean} Show the product countdown. Default: true
    - show_secondary_image: {Boolean} Show the secondary image on hover. Default: false (optional)
    - show_vendor: {Boolean} Show the product vendor. Default: false
    - show_type: {Boolean} Show the product type. Default: false
    - hover_underline: {Boolean} The product name hover underline. Default: false (optional)
    - truncate_product_name: {Boolean} Truncate the product name. Value is 48. Default: false (optional)
    - show_price: {Boolean} Show the product price. Default: true
    - button_type_product: {String} Size of the product image card. Values are "hide", "show", "show only text" and "show only icon". Default is "show"
    - button_type_product_mobile: {Boolean} Show on mobile works with option button_type_product
	- page_is_wide: {Boolean} Page width for image size. Default: false
	- section_id: {String} The ID of the section that contains this card.
    - hide_product_card_swatches: {Boolean} Show product card swatches. Default: false
    - image_hover_type: {String}
    - show_quantity: {Boolean} Add to cart count number
    - small_radius: {Boolean} Default false
    - show_wishlist: {Boolean} Default false
    - show_compare: {Boolean} Default false
    - show_quick_view: {Boolean} Default false
    - show_wishlist_mobile: {Boolean} Default false
    - show_compare_mobile: {Boolean} Default false
    - show_quick_view_mobile: {Boolean} Default false
    - text_aligment: {String}
    - show_description: {Boolean} Default false
    - load_priority_low: String, default empty
    - remove_from_wishlist: {Boolean} Works on wishlist page. Default undefined
    - enable_rating_product_card: {Boolean} html content created from review apps

    Usage:
    {% render 'product-card', show_vendor: section.settings.show_vendor %}

    {%- render 'product-card',
       product_card_product: product,
       product_collection:__collection,
       image_hover_type: section.settings.image_hover,
       show_price:section.settings.show_price,
       show_vendor:section.settings.show_vendor,
       show_type:section.settings.show_type
    -%}
{%- endcomment -%}
{%- assign enable_rating_product_card = enable_rating_product_card | default: false -%}
{%- liquid
    unless customize
    assign text_aligment = settings.text_align_product_card
    assign hover_underline = settings.hover_underline_product_card
    assign show_badge_on_sale = settings.show_badge_on_sale_product_card
    assign show_badge_sold_out = settings.show_badge_sold_out_product_card
    assign show_badge_feature = settings.show_badge_feature_product_card
    assign show_countdown = settings.show_countdown_product_card
    assign show_vendor = settings.show_vendor_product_card
    assign show_type = settings.show_type_product_card
    assign show_price = settings.show_price_product_card
    assign show_description = settings.show_description_product_card
    assign truncate_product_name = settings.truncate_product_name_product_card
    assign show_quantity = settings.show_quantity_product_card
    assign button_type_product = settings.button_type_product_product_card
    assign button_type_product_mobile = settings.button_type_product_mobile_product_card
    assign show_wishlist = settings.show_wishlist_product_card
    assign show_compare = settings.show_compare_product_card
    assign show_quick_view = settings.show_quick_view_product_card
    assign show_wishlist_mobile = settings.show_wishlist_mobile_product_card
    assign show_compare_mobile = settings.show_compare_mobile_product_card
    assign show_quick_view_mobile = settings.show_quick_view_mobile_product_card
    assign enable_rating_product_card = settings.enable_rating_product_card
    endunless
-%}
{%- assign pr_name_size = pr_name_size | default: 'product-card-name-size' -%}
{%- assign last_characters = 'general.abbreviation_of_text_in_a_section.last_characters' | t -%}
{%- assign id_code = 'card-' | append:product_card_product.id | append: section.id -%}

{%- capture badges -%}
{%- if product_card_product.available == false and show_badge_sold_out -%}
<span class="badges-item__medium badges-item__sold-out">{{ 'products.product.sold_out' | t }}</span>
{%- elsif product_card_product.available and show_badge_on_sale -%}
{%- if button_type_product == "hide" or settings.badge_sale_type == "text" -%}
{%- if product_card_product.compare_at_price > product_card_product.price %}
<span class="badges-item__medium badges-item__sale">{{ 'products.product.on_sale' | t }}</span>
{%- endif -%}
{%- else -%}
{%- assign target = product_card_product.selected_or_first_available_variant -%}
{%- capture percent -%}{%- render 'badge-sale-percent', target:target -%}{%- endcapture -%}
<span class="badges-item__medium badges-item__sale badges-item__sale__counter{% unless target.compare_at_price > target.price %} hide{% endunless %}">{{ 'products.product.on_sale_html' | t: percent_text: percent }}</span>
{%- endif -%}
{%- endif -%}
{%- if product_card_product.metafields.wokiee.countdown != blank and show_countdown -%}
  {%- assign _time = product_card_product.metafields.wokiee.countdown -%}
  {%- assign year = _time | split:'T' | first | split:'-' | first -%}
  {%- assign month = _time | split:'T' | first | split:'-' -%}
  {%- assign month = month[1] -%}
  {%- assign day = _time | split:'T' | first | split:'-' | last -%}
  {%- assign hours = _time | split:'T' | last | split:':' | first -%}
  {%- assign minutes = _time | split:'T' | last | split:':' -%}
  {%- assign minutes = minutes[1] -%}
  {%- assign seconds = _time | split:'T' | last | split:':' | last | split:'Z' | first -%}
  <countdown-timer class="badges-item__medium badges-item__countdown-timer" data-end-date="{{ year }},{{ month | minus:1 }},{{ day }},{{ hours }},{{ minutes }},{{ seconds }}">
    <style class="hide">
      .badges-item__countdown-timer{
        display:flex;
        flex-direction:row;
        color:var(--color-counter, var(--color-base-section, var(--color-countdown-text-main)));
        background:var(--color-countdown-bg-block, var(--color-countdown-bg));
      }
      .badges-item__countdown-timer:not(.timer-activated){
        display:none;
      }
    </style>
    <p class="countdown-timer__item__days mt0 mb0">0</p>
    <p class="mt0">:</p>
    <p class="countdown-timer__item__hours mt0 mb0">0</p>
    <p class="mt0">:</p>
    <p class="countdown-timer__item__minutes mt0 mb0">0</p>
    <p class="mt0">:</p>
    <p class="countdown-timer__item__seconds mt0 mb0">0</p>
  </countdown-timer>
{%- endif -%}
{%- if product_card_product.metafields.wokiee.featured_badge != blank and show_badge_feature -%}
<span class="badges-item__medium badges-item__main">{{ product_card_product.metafields.wokiee.featured_badge }}</span>
{%- endif -%}
{%- endcapture -%}

{%- assign media_buttons_count_d = 0 -%}
{%- assign media_buttons_count = 0 -%}

{%- if show_wishlist -%}
{%- assign media_buttons_count_d = media_buttons_count_d | plus: 1 -%}
{%- endif -%}
{%- if show_compare -%}
{%- assign media_buttons_count_d = media_buttons_count_d | plus: 1 -%}
{%- endif -%}
{%- if show_quick_view -%}
{%- assign media_buttons_count_d = media_buttons_count_d | plus: 1 -%}
{%- endif -%}
{%- if show_wishlist_mobile -%}
{%- assign media_buttons_count = media_buttons_count | plus: 1 -%}
{%- endif -%}
{%- if show_compare_mobile -%}
{%- assign media_buttons_count = media_buttons_count | plus: 1 -%}
{%- endif -%}
{%- if show_quick_view_mobile -%}
{%- assign media_buttons_count = media_buttons_count | plus: 1 -%}
{%- endif -%}

{%- capture media_buttons -%}
{%- if settings.enable_wishlist and remove_from_wishlist == empty? -%}
{%- if show_wishlist or show_wishlist_mobile -%}
<wishlist-button
   class="product-card__media-buttons__item{% if show_wishlist == false %} hide-lg hide-st{% endif %}{% if show_wishlist_mobile == false %} hide-sp{% endif %}"
   data-text="{{ 'wishlist.product.wishlist' | t }}"
   data-text-active="{{ 'wishlist.product.wishlist-remove' | t }}"
   data-id="{{ product_card_product.id }}"
   data-product-handle="{{ product_card_product.handle }}"
  >
  {%- render "icon-wishlist" icon_type:"normal" -%}
  {%- render "icon-wishlist" icon_type:"added" -%}
</wishlist-button>
{%- endif -%}
{%- endif -%}
{%- if settings.enable_compare and remove_from_compare == empty? -%}
{%- if show_compare or show_compare_mobile -%}
<compare-button
   class="product-card__media-buttons__item{% if show_compare == false %} hide-lg hide-st{% endif %}{% if show_compare_mobile == false %} hide-sp{% endif %}"
   data-text="{{ 'compare.product.compare' | t }}"
   data-text-active="{{ 'compare.product.compare-remove' | t }}"
   data-id="{{ product_card_product.selected_or_first_available_variant.id }}"
   data-product-handle="{{ product_card_product.handle }}"
  >
  {{- 'icon-compare' | append: settings.system_icon_thickness | inline_asset_content -}}
</compare-button>
{%- endif -%}
{%- endif -%}
{%- if show_quick_view or show_quick_view_mobile -%}

<modal-opener class="display-flex justify-content-end popup-modal__opener{% if show_quick_view == false %} hide-lg hide-st{% endif %}{% if show_quick_view_mobile == false %} hide-sp{% endif %}" data-modal="#PopupModal-quickview" data-handle="{{ product_card_product.url | within: product_collection }}">
  <button class="product-card__media-buttons__item"
          type="button"
          aria-haspopup="dialog"
          data-text="{{ 'products.product.quick-view' | t }}"
          aria-label="{{ 'products.product.quick-view' | t }}"
    >
	{{- 'icon-eye' | append: settings.system_icon_thickness | inline_asset_content -}}
  </button>
</modal-opener>
{%- endif -%}

{%- if settings.enable_wishlist and remove_from_wishlist -%}
<wishlist-button
   class="product-card__media-buttons__item delete-item-button"
   data-text="{{ 'wishlist.product.wishlist-remove' | t }}"
   data-text-active="{{ 'wishlist.product.wishlist-remove' | t }}"
   data-id="{{ product_card_product.id }}"
   aria-label="{{ 'wishlist.product.wishlist-remove' | t }}"
  >
  {{- 'icon-remove' | append: settings.system_icon_thickness | inline_asset_content -}}
</wishlist-button>
{%- endif -%}
  
{%- endcapture -%}
{%- unless load_priority_low -%}{% assign load_priority_low = 'true' %}{% endunless %}
<div id="product-{{ id_code }}" class="product-card {{ text_aligment }} {%- if show_secondary_image != "gallery" -%}{% if image_hover_type == "default" %}{{ settings.image_hover }}{% else %}{{ image_hover_type }}{% endif %}-personal{% endif %}{% if button_type_product != "hide" %} {{ settings.product_card_button_type }}{% endif %}{% if settings.product_card_image_resize == "contain" %} product-card-image--contain{% endif %}{% if settings.product_card_button_type == "product_card__button_hover" and show_quantity %} product-card__quantity-form{% endif %}">
  {%- if product_card_product.featured_media != blank -%}
  <div class="product-card__image__container image-hover-personal-element">
    <div class="product-card__image">
      <a href="{{ product_card_product.url | within: product_collection }}" class="product-card__image__url{% if show_secondary_image == "gallery" %} product-card__image__url__slider-mask{% endif %}"
         aria-label="{{ product_card_product.title }}"
        >
        {%- if show_secondary_image != "gallery" -%}
        <div class="image-hover-box__container{% if image_ratio_value == '1.00' %} image-hover-box--circle{% endif %}">
          {%- render "component-image-product-card",
              image_ratio_value: image_ratio_value,
              image_source: product_card_product.featured_media,
              image_source2: product_card_product.media[1],
              show_image_source2: show_secondary_image,
              section_index: section.index,
              load_priority_low: load_priority_low,
              small_radius: small_radius
          -%}
        </div>
        {%- else -%}
        <swiper-slider class="swiper swiper__no-padding-bottom swiper-nested swiper__animated-arrows swiper-no-pad swiper-no-marg swiper-slide__with-bg{% if image_ratio_value == '1.00' %} image-hover-box--circle{% endif %}"
                       data-swiper-desktop-grid="1"
                       data-swiper-desktop-lg-grid="1"
                       data-swiper-desktop-md-grid="1"
                       data-swiper-tablet-grid="1"
                       data-swiper-mobile-grid="1"
                       data-gutter="0"
                       data-gutter-mobile="0"
                       data-grid="1,1,1,1,1"
                       data-autoplay="false"
                       data-autoheight="true"
                       data-script="{{ 'swiper-bundle.min.js' | asset_url }}"
          >
          <div class="swiper-wrapper">
            {%- liquid
                assign colors_array = product_card_product.metafields.wokiee.grouped_gallery | downcase
                if colors_array and colors_array != blank
                assign colors_array = product_card_product.metafields.wokiee.grouped_gallery | split: ','
                endif
            -%}
            {%- for media in product_card_product.media -%}
            {%- if media.media_type == 'image' -%}
            <div class="swiper-slide"
                 {% if colors_array != blank %}data-current-color="{{ colors_array[forloop.index0] | downcase }}"{% endif %}
                 lazy="true">
              <div class="image-hover-box__container">
                {%- render "component-image-product-card",
                    image_ratio_value: image_ratio_value,
                    image_source: media.preview_image,
                    load_priority_low: load_priority_low,
                    section_index: section.index,
                    small_radius: small_radius
                -%}
              </div>
            </div>
            {%- endif -%}
            {%- endfor -%}
          </div>
        </swiper-slider>
        <div class="swiper-control-container swiper-control-container__absolute">
          <div class="internal-swiper-button-prev">{{- 'icon-arrow-left' | append: settings.system_icon_thickness | inline_asset_content -}}</div>
          <div class="swiper-pagination hide-desktop"></div>
          <div class="internal-swiper-button-next">{{- 'icon-arrow-right' | append: settings.system_icon_thickness | inline_asset_content -}}</div>
        </div>
        {%- endif -%}
      </a>
    </div>
    {%- if media_buttons != blank -%}
    <productcard-buttons class="product-card__media-buttons product-card__media-buttons--animation product-card__media-buttons_fixed{% if media_buttons_count == 1 %} product-card__media-buttons--show-always{% endif %}">{{- media_buttons -}}</productcard-buttons>
    {%- endif -%}
    <div class="badges__container{% if show_badge_on_sale == false %} hide__badges-item__sale{% endif %}">{{- badges -}}</div>
  </div>
  {%- endif -%}
  <product-form class="product-card__content{% if button_type_product_mobile == false %} product-card__interface--hide-mobile{% endif %}">
    {%- assign product_card_product_id = section.id | append: product_card_product.id -%}
    {%- form 'product', product_card_product, id: product_card_product_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
    <div class="product-card__content__main">
      {%- if product_card_product.featured_media == blank and badges != blank -%}
      <div class="badges__container">{{- badges -}}</div>
      {%- endif -%}
      {%- if show_vendor and product_card_product.vendor != blank -%}
      <div class="body3">
        <a class="mt0 product-card-small__meta link link__base-to_accent-color text-uppercase a--no-hover-color native-hover{% if hover_underline == false %} link--no-underline{% endif %}"
           href="{{ routes.collections_url }}/{% if product_collection == blank %}all{% else %}{{ product_collection.handle }}{% endif %}?filter.p.vendor={{ product_card_product.vendor | escape }}">{{ product_card_product.vendor }}</a>
      </div>
      {%- endif -%}
      {%- if show_type and product_card_product.type != blank -%}
      <div class="body3 mt3">
        <a class="mt0 product-card-small__meta link link__base-to_accent-color text-uppercase a--no-hover-color native-hover{% if hover_underline == false %} link--no-underline{% endif %}"
           href="{{ routes.collections_url }}/{% if product_collection == blank %}all{% else %}{{ product_collection.handle }}{% endif %}?filter.p.product_type={{ product_card_product.type | escape }}">{{ product_card_product.type }}</a>
      </div>
      {%- endif -%}

      <div class="body2 mt3 product-card__heading">
        <a href="{{ product_card_product.url | within: product_collection }}" class="{{ pr_name_size }} product-card-small__heading heading-color-block-hover a--no-hover-color clear-underline{% if hover_underline %} animation-underline{% endif %} native-hover">
          {%- if truncate_product_name -%}
          {{ product_card_product.title | escape | truncate: 48,last_characters }}
          {%- else -%}
          {{ product_card_product.title | escape }}
          {%- endif -%}
        </a>
      </div>

      {%- if settings.enable_rating and settings.cart_type != "catalog_mode" -%}{%- if enable_rating_product_card -%}
      {%- render 'review-stars' _product: product_card_product -%}
      {%- endif -%}{%- endif -%}      
      {%- if show_price and settings.cart_type != "catalog_mode" -%}
      <div id="price-{{ id_code }}">{%- render 'price', product: product_card_product, size:settings.product_card_price_size, button_type_product:button_type_product -%}</div>
      {%- endif -%}

      {%- if show_description and product_card_product.metafields.wokiee.small_description != blank -%}
      <div class="mt8 body3 product-card__description">
      {{ product_card_product.metafields.wokiee.small_description }}
      </div>
      {%- endif -%}
      
      {%- if product_card_product.featured_media == blank and media_buttons != blank -%}
      <div class="product-card__media-buttons product-card__media-buttons__inline">{{- media_buttons -}}</div>
      {%- endif -%}

      {%- if button_type_product != "hide" -%}
      {% render 'product-card-variant-picker',
                section:section,
                product: product_card_product,
                product_form_id: product_card_product_id,
                page_width:page_width,
                id_code:id_code
      %}
      <div class="product-form__error-message-wrapper mt10" role="alert" hidden>
        <span class="product-form__error-message color-error body3"></span>
      </div>
      {%- endif -%}

    </div>
    {%- if button_type_product != "hide" and settings.cart_type != "catalog_mode" -%}
    <div class="product-card__interface{% if show_quantity %} product-card__interface--small{% endif %}{% if show_quantity and button_type_product == 'only_icon' %} product-card__interface--quantity{% endif %}">
      <div id="form-{{ id_code }}"
           class="product-card__form"
        >
        {%- assign current_variant = product_card_product.selected_or_first_available_variant -%}
        {%- if show_quantity -%}
        {%- assign inv_man = current_variant.inventory_management -%}{%- assign inv_qua = current_variant.inventory_quantity | plus: 0 -%}{%- unless inv_man -%}{%- assign inv_qua = 100000 -%}{%- endunless -%}{%- if current_variant.inventory_policy == "continue" -%}{%- assign inv_qua = 100000 -%}{%- endif -%}
        <quantity-input class="field quantity product-card__quantity">
          <button class="quantity__button no-js-hidden" name="minus" type="button">
            <span class="visually-hidden">{{ 'products.product.quantity.decrease' | t: product: product.title | escape }}</span>
            {{- 'icon-minus' | append: settings.system_icon_thickness | inline_asset_content -}}
          </button>
          <input class="field__input quantity__input"
                type="number"
                name="quantity"
                id="Quantity-{{ id_code }}"
                min="1"
                max="{{ inv_qua }}"
                value="1"
                form="{{  product_card_product_id }}"
                >
          <button class="quantity__button no-js-hidden" name="plus" type="button">
            <span class="visually-hidden">{{ 'products.product.quantity.increase' | t: product: product.title | escape }}</span>
			    {{- 'icon-plus' | append: settings.system_icon_thickness | inline_asset_content -}}
          </button>
        </quantity-input>
        {%- endif -%}
        <input type="hidden" name="id" value="{{ product_card_product.selected_or_first_available_variant.id }}">
        <button type="submit"
                name="add"
                class="quick-add__submit btn btn__transition-text btn-card-width {% if button_type_product == 'only_icon' %} only-child{% endif %}"
                data-type="{% if show_quantity and button_type_product == 'only_icon' %}type0{% elsif button_type_product == 'only_icon' %}type1{% elsif button_type_product == 'only_text' %}type2{% elsif button_type_product == 'show' %}type3{% endif %}"
                {% if product_card_product.selected_or_first_available_variant.available == false %}
                disabled
                aria-disabled="true"
                {% endif %}
                >
          <div class="btn__texts">
            {%- if show_quantity and button_type_product == 'only_icon' -%}
            <span class="btn__top-text is-visible">
            {%- render "icon-cart" -%}
            </span>
            <span class="btn__bottom-text is-hidden">
            {%- render "icon-cart" -%}
            </span>
            {%- else -%}
            <span class="btn__top-text is-visible">
            {%- if product_card_product.selected_or_first_available_variant.available -%}
            {%- if button_type_product != "only_text" -%}{%- render "icon-cart" -%}{%- endif -%}
            {%- if button_type_product != "only_icon" -%}
            {%- if current_variant.inventory_management == 'shopify' and current_variant.inventory_policy == 'continue' and current_variant.inventory_quantity <= 0 -%}
            {{ "products.product.preorder" | t }}
            {%- else -%}
            {{ 'products.product.add_to_cart' | t }}
            {%- endif -%}
            {%- endif -%}
            {%- else -%}{{ 'products.product.sold_out' | t }}{%- endif -%}
            </span>
            <span class="btn__bottom-text is-hidden">
            {%- if product_card_product.selected_or_first_available_variant.available -%}
            {%- if button_type_product != "only_text" -%}{%- render "icon-cart" -%}{%- endif -%}
            {%- if button_type_product != "only_icon" -%}
            {%- if current_variant.inventory_management == 'shopify' and current_variant.inventory_policy == 'continue' and current_variant.inventory_quantity <= 0 -%}
            {{ "products.product.preorder" | t }}
            {%- else -%}
            {{ 'products.product.add_to_cart' | t }}
            {%- endif -%}
            {%- endif -%}
            {%- else -%}{{ 'products.product.sold_out' | t }}{%- endif -%}
            </span>
            {%- endif -%}
          </div>
          <div class="loading-overlay__spinner hidden">
            <svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
              <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
            </svg>
          </div>
        </button>
      </div>
      {%- if media_buttons != blank -%}
      <div class="product-card__media-buttons product-card__media-buttons__inline product-card__media-buttons--mobile{% if media_buttons_count == 1 %} product-card__media-buttons--show-always{% endif %}">{{- media_buttons -}}</div>
      {%- endif -%}
    </div>
    {%- else -%}
    <div class="product-card__interface product-card__interface__icons">
      {%- if media_buttons_count_d > 0 or media_buttons_count > 0 -%}
      <div class="product-card__media-buttons product-card__media-buttons__inline product-card__media-buttons--mobile{% if media_buttons_count == 1 %} product-card__media-buttons--show-always{% endif %}">{{- media_buttons -}}</div>
      {%- endif -%}
    </div>
    {%- endif -%}
    {%- endform -%}
  </product-form>
</div>